# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This is an RPG Maker MZ game project titled "Pharmageddon". RPG Maker MZ is a game development engine that uses JSON data files for game content and JavaScript for game logic and plugins.

## Key Technologies

- **Engine**: RPG Maker MZ (v1.9.0)
- **Runtime**: NW.js (Node-Webkit) for desktop deployment
- **Graphics**: PixiJS (WebGL renderer)
- **Script Loading**: Sequential loading via `js/main.js`
- **Data Format**: JSON files in `data/` directory

## Architecture

### Script Loading Order

The game follows a strict loading sequence defined in `js/main.js`:
1. Core libraries (PixiJS, pako, localforage, effekseer, vorbisdecoder)
2. Engine core (`rmmz_core.js`)
3. Game managers (`rmmz_managers.js`)
4. Game objects (`rmmz_objects.js`)
5. Scene management (`rmmz_scenes.js`)
6. Sprites (`rmmz_sprites.js`)
7. Windows/UI (`rmmz_windows.js`)
8. Plugin loader (`plugins.js`)

After all scripts load, `PluginManager.setup($plugins)` initializes plugins, then `Scene_Boot` starts the game.

### Data Structure

Game content is stored as JSON in the `data/` directory:
- **Maps**: `Map001.json`, `Map002.json`, etc. (tile-based level data)
- **Database**: `Actors.json`, `Classes.json`, `Items.json`, `Skills.json`, `Weapons.json`, `Armors.json`, `States.json`, `Enemies.json`, `Troops.json`
- **Configuration**: `System.json` (game settings, title, BGM, variables, switches)
- **Assets**: `Tilesets.json`, `Animations.json`, `CommonEvents.json`
- **Map Index**: `MapInfos.json` (map hierarchy and names)

### Plugin System

Custom plugins live in `js/plugins/` and are registered in `js/plugins.js` (auto-generated by RPG Maker editor). Available plugins:
- `AltSaveScreen.js`: Custom save screen UI
- `AltMenuScreen.js`: Custom menu screen UI
- `TextPicture.js`: Display text as pictures
- `ButtonPicture.js`: Picture-based button functionality

**Important**: `plugins.js` is auto-generated. Enable/disable plugins using RPG Maker's Plugin Manager, not by editing this file directly.

### Asset Directories

- `img/`: Graphics (tilesets, characters, animations, parallaxes, etc.)
- `audio/`: Sound and music (bgm/, bgs/, me/, se/ subdirectories)
- `fonts/`: Custom fonts (`mplus-2p-bold-sub.woff`, `Valorax-lg25V.otf`)
- `movies/`: Video files
- `effects/`: Effekseer particle effects
- `icon/`: Application icon

## Development Workflow

### Running the Game

Open `index.html` in a web browser or use NW.js desktop app. The game requires local file access, so some browsers may need CORS workarounds for development.

### Version Control

- **Git LFS**: Configured via `.gitattributes` for large binary assets (audio, images, videos)
- **Branch Strategy**: Feature branches from `main` following `feature/<name>-<scope>` pattern
- **Commit Style**: Follow [Conventional Commits](https://www.conventionalcommits.org/en/v1.0.0/#summary)

### Collaboration Guidelines

**Map Editing**: Avoid concurrent edits to the same `MapXXX.json` file. Coordinate with team members before editing maps, as merge conflicts in map JSON are difficult to resolve.

**Database Changes**: Batch related changes to database files (`Actors.json`, `Classes.json`, etc.) in a single PR when possible to minimize conflicts.

**Plugin Development**:
- Place new JavaScript plugins in `js/plugins/`
- Use RPG Maker's Plugin Manager to enable/disable plugins (this updates `plugins.js`)
- Never manually edit `plugins.js`

**Asset Naming**:
- Use kebab-case, descriptive names (e.g., `inn-exterior.png`, `npc-bartender-01.png`)
- Audio: prefix with type if helpful (e.g., `bgm-town-day.ogg`)
- Keep filenames lowercase

### Pull Request Requirements

- Fetch latest `main` before starting work
- Art/audio filenames must be descriptive and lowercase
- Fill out PR checklist in CONTRIBUTING.md
- Requires 1 approval before merge to `main`

## Game Configuration

- **Title**: Pharmageddon
- **Resolution**: 816x624 pixels
- **Starting Map**: Map001, position (8, 6)
- **Party Members**: Actors 1, 4, 6, 7
- **Battle System**: Front-view (turn-based)
- **Title BGM**: MainTheme
- **Battle BGM**: Battle1

## Important Notes

- **Do not modify** core RMMZ files (`rmmz_*.js`) unless absolutely necessary
- **Map IDs** are auto-assigned by RPG Maker; maintain external documentation for human-readable map names
- **System.json** contains critical game configuration; changes should be made through RPG Maker editor when possible
- The game uses custom fonts: ensure `mplus-2p-bold-sub.woff` and `Valorax-lg25V.otf` remain in `fonts/`
